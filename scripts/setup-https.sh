#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ HTTPS –¥–ª—è –±—ç–∫–µ–Ω–¥–∞

echo "üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTPS –¥–ª—è –±—ç–∫–µ–Ω–¥–∞..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞ mkcert
if ! command -v mkcert &> /dev/null; then
    echo "‚ùå mkcert –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: brew install mkcert"
    exit 1
fi

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ CA (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ CA..."
mkcert -install

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
CERT_DIR="src/main/resources/certs"
mkdir -p "$CERT_DIR"
cd "$CERT_DIR"

# –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –¥–ª—è IP –∞–¥—Ä–µ—Å–∞
echo "üîê –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –¥–ª—è 192.168.1.13..."
mkcert 192.168.1.13 localhost

# –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ PKCS12
echo "üîÑ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ PKCS12 —Ñ–æ—Ä–º–∞—Ç..."
openssl pkcs12 -export \
  -in 192.168.1.13+1.pem \
  -inkey 192.168.1.13+1-key.pem \
  -out keystore.p12 \
  -name server \
  -password pass:changeit

echo "‚úÖ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Å–æ–∑–¥–∞–Ω—ã!"
echo "üìÅ –§–∞–π–ª—ã:"
echo "   - keystore.p12 (–¥–ª—è Spring Boot)"
echo ""
echo "üöÄ –¢–µ–ø–µ—Ä—å –∑–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–µ–Ω–¥:"
echo "   cd gas && ./gradlew bootRun"
echo ""
echo "üåê –ë—ç–∫–µ–Ω–¥ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ:"
echo "   - HTTPS: https://192.168.1.13:8080"



